(this["webpackJsonpiss-map"]=this["webpackJsonpiss-map"]||[]).push([[0],{111:function(e,t){},113:function(e,t){},128:function(e,t,n){},134:function(e,t,n){},135:function(e,t,n){},136:function(e,t,n){},137:function(e,t,n){"use strict";n.r(t);var r=n(2),i=n.n(r),a=n(57),s=n.n(a),o=n(20),c=n.n(o),l=n(13),u=n(69),d=n(28),f=n(9),j=n(3),p=n(66),h=(n(76),n(29)),b=n.n(h),m=function(e){var t={type:"FeatureCollection",features:[]};for(var n in e){var r=e[n];if(!r.lng||!r.lat)return;for(var i={type:"Feature",geometry:{type:"Point",coordinates:[Number(r.lng),Number(r.lat)]},properties:{_id:n}},a=0;a<Object.keys(r).length;a++){var s=Object.keys(r)[a];i.properties[s]=r[s]}t.features.push(i)}return t},g=(n(83),n(58)),x=function(e){var t="";return"number"!==typeof e||Number.isNaN(e)||(t=e>1e3?Math.round(e/1e3)+" km":Math.round(e)+" m"),t},v=(n(84),n(1)),O=function(e){var t=e.shop,n=Object.entries(t).filter((function(e,t){var n=e[0],r=e[1];return!["_id","index","distance","lat","lng","title","description","marker-size","marker-symbol","marker-color","stroke","stroke-width","fill"].includes(n)&&Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:n}),Object(v.jsx)("td",{children:r})]},t)}));return 0!==n.length?Object(v.jsx)("table",{className:"shop-meta-table",children:Object(v.jsx)("tbody",{children:n})}):Object(v.jsx)(v.Fragment,{})},y=function(e){var t=i.a.useRef(null),n=i.a.useState(null),r=Object(f.a)(n,2),a=r[0],s=r[1],o=e.shop;i.a.useEffect((function(){if(t.current){var e=new window.geolonia.Map({container:t.current,interactive:!1,zoom:14});s(e)}}),[o,t]);var c=x(o.distance);return Object(v.jsxs)("div",{className:"shop-single",children:[Object(v.jsx)("div",{className:"head",children:Object(v.jsxs)("button",{onClick:function(){e.close(),t.current&&(t.current.remove(),a.remove())},children:[Object(v.jsx)(g.a,{size:"16px",color:"#FFFFFF"})," \u9589\u3058\u308b"]})}),Object(v.jsx)("div",{className:"container",children:o?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("h2",{children:o.title}),Object(v.jsx)("div",{children:Object(v.jsx)("span",{className:"nowrap",children:c&&Object(v.jsxs)("span",{className:"distance",children:["\u73fe\u5728\u4f4d\u7f6e\u304b\u3089 ",c]})})}),Object(v.jsx)("div",{className:"description",children:o.description}),Object(v.jsx)(O,{shop:o}),Object(v.jsx)("div",{ref:t,style:{width:"100%",height:"200px",marginTop:"24px"},"data-lat":o.lat,"data-lng":o.lng,"data-navigation-control":"on"})]}):Object(v.jsx)(v.Fragment,{})})]})},k=n(59),w=n(60),N=function(){function e(t,n,r){Object(k.a)(this,e),this.json=void 0,this.map=void 0,this.options=void 0,this.json=t,this.map=n,this.options=Object(l.a)({cluster:!0,heatmap:!1,clusterColor:"#ff0000"},r)}return Object(w.a)(e,[{key:"addTo",value:function(e){if(this.json){var t=this.json.features.filter((function(e){return"point"===e.geometry.type.toLowerCase()}));e.addSource("geolonia-simple-style-points",{type:"geojson",data:{type:"FeatureCollection",features:t},cluster:this.options.cluster,clusterMaxZoom:14,clusterRadius:50}),this.setPointGeometries(e),this.setCluster(e);var n=e.getContainer();if(!n.dataset||!n.dataset.lng&&!n.dataset.lat){var r=b()(this.json);e.fitBounds(r,{duration:0,padding:30})}}}},{key:"setPointGeometries",value:function(e){e.addLayer({id:"circle-simple-style-points",type:"circle",source:"geolonia-simple-style-points",filter:["!",["has","point_count"]],paint:{"circle-radius":["case",["==","small",["get","marker-size"]],7,["==","large",["get","marker-size"]],13,9],"circle-color":["string",["get","marker-color"],"rgba(255, 0, 0, 0.4)"],"circle-opacity":["number",["get","fill-opacity"],.4],"circle-stroke-width":["number",["get","stroke-width"],2],"circle-stroke-color":["string",["get","stroke"],"#FFFFFF"],"circle-stroke-opacity":["number",["get","stroke-opacity"],1]}}),e.addLayer({id:"symbol-simple-style-points",type:"symbol",source:"geolonia-simple-style-points",filter:["!",["has","point_count"]],paint:{"text-color":["string",["get","text-color"],"#000000"],"text-halo-color":["string",["get","text-halo-color"],"#FFFFFF"],"text-halo-width":2},layout:{"icon-image":["case",["==","large",["get","marker-size"]],["image",["concat",["get","marker-symbol"],"-15"]],["image",["concat",["get","marker-symbol"],"-11"]]],"text-field":["get","title"],"text-font":["Noto Sans Regular"],"text-size":12,"text-anchor":"top","text-variable-anchor":["top","bottom","left","right"],"text-max-width":12,"text-offset":["case",["==","small",["get","marker-size"]],["literal",[0,.6]],["==","large",["get","marker-size"]],["literal",[0,1.2]],["literal",[0,.8]]],"text-allow-overlap":!1,"text-radial-offset":.5,"text-justify":"auto"}}),e.on("mouseenter","circle-simple-style-points",(function(){e.getCanvas().style.cursor="pointer"})),e.on("mouseleave","circle-simple-style-points",(function(){e.getCanvas().style.cursor=""})),e.on("mouseenter","symbol-simple-style-points",(function(){e.getCanvas().style.cursor="pointer"})),e.on("mouseleave","symbol-simple-style-points",(function(){e.getCanvas().style.cursor=""}))}},{key:"setCluster",value:function(e){e.addLayer({id:"clusters",type:"circle",source:"geolonia-simple-style-points",filter:["has","point_count"],paint:{"circle-radius":20,"circle-color":this.options.clusterColor,"circle-opacity":1}}),e.addLayer({id:"cluster-count",type:"symbol",source:"geolonia-simple-style-points",filter:["has","point_count"],paint:{"text-color":"#FFFFFF"},layout:{"text-field":"{point_count_abbreviated} \u4ef6","text-size":12,"text-font":["Noto Sans Regular"]}}),e.on("click","clusters",(function(t){var n=e.queryRenderedFeatures(t.point,{layers:["clusters"]}),r=n[0].properties.cluster_id;e.getSource("geolonia-simple-style-points").getClusterExpansionZoom(r,(function(t,r){t||e.easeTo({center:n[0].geometry.coordinates,zoom:r})}))})),e.on("mouseenter","clusters",(function(){e.getCanvas().style.cursor="pointer"})),e.on("mouseleave","clusters",(function(){e.getCanvas().style.cursor=""}))}}]),e}(),F=function e(t,n){fetch("https://api.wheretheiss.at/v1/satellites/25544").then((function(e){return e.json()})).then((function(e){var r=[e.longitude,e.latitude];t.setLngLat(r).addTo(n),n.flyTo({center:r})})),setTimeout((function(){e(t,n)}),2e3)},C=n(6),S={width:"100%",height:"100%",position:"relative"},z=function(e){var t=i.a.useRef(null),n=i.a.useState(),r=Object(f.a)(n,2),a=r[0],s=r[1],o=i.a.useState(void 0),c=Object(f.a)(o,2),l=c[0],u=c[1];i.a.useEffect((function(){if(a&&e.data&&!a.getSource("shops")){var t=m(e.data);new N(t,a,{cluster:!0,clusterColor:C.markers.clusterColor}).addTo(a),a.on("click","circle-simple-style-points",(function(e){e.features[0].properties.cluster||u(e.features[0].properties)})),a.on("click","symbol-simple-style-points",(function(e){e.features[0].properties.cluster||u(e.features[0].properties)}))}}),[a,e.data]),i.a.useEffect((function(){if(t.current&&!a&&0!==e.data.length){var n=window.geolonia,r=m(e.data),i=b()(r),o=document.querySelector("#iss");if(o){var c=new n.Marker({element:o,offset:[-3,-28]}),l=new n.Map({container:t.current,style:"geolonia/gsi",bounds:i,fitBoundsOptions:{padding:50}}),u=function(){l.setLayoutProperty("poi","visibility","none"),l.setLayoutProperty("poi-primary","visibility","none"),F(c,l),s(l),o.style.display="block"},d=function(){l.resize()};return l.on("load",u),window.addEventListener("orientationchange",d),function(){window.removeEventListener("orientationchange",d),l.off("load",u)}}}}),[t,a,e.data]);return Object(v.jsxs)("div",{style:S,children:[Object(v.jsx)("div",{ref:t,style:S,"data-geolocate-control":"on","data-marker":"off","data-gesture-handling":"off"}),l?Object(v.jsx)(y,{shop:l,close:function(){u(void 0)}}):Object(v.jsx)(v.Fragment,{})]})},L=function(e){return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(z,{data:e.data})})},E=n(61),P=(n(86),function(e){var t=x(e.data.distance);return Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)("button",{className:"shop-link",onClick:function(){e.popupHandler(e.data)},children:[Object(v.jsx)("h2",{children:e.data.title}),Object(v.jsx)("div",{children:Object(v.jsx)("span",{className:"nowrap",children:t&&Object(v.jsxs)("span",{className:"distance",children:["\u73fe\u5728\u4f4d\u7f6e\u304b\u3089 ",t]})})}),Object(v.jsx)("div",{style:{margin:"16px 0"},children:Object(v.jsx)(O,{shop:e.data})}),Object(v.jsx)("div",{className:"right",children:Object(v.jsx)(E.a,{size:"40px",color:"#CCCCCC"})})]})})}),_=(n(87),n(31)),R=function(){var e=Object(d.a)(c.a.mark((function e(t){var n,r,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,t){window.navigator.geolocation&&window.navigator.geolocation.getCurrentPosition||e(null),window.navigator.geolocation.getCurrentPosition((function(t){var n=t.coords.latitude,r=t.coords.longitude;e([r,n])}),(function(t){e(null)}),{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})}));case 2:if(!(n=e.sent)){e.next=10;break}return r=_.point(n),(i=t.map((function(e){var t=parseFloat(e.lng),n=parseFloat(e.lat);if(Number.isNaN(t)||Number.isNaN(n))return e;var i=_.point([t,n]),a=_.distance(r,i,{units:"meters"});return Object(l.a)(Object(l.a)({},e),{},{distance:a})}))).sort((function(e,t){return"number"!==typeof e.distance||Number.isNaN(e.distance)?1:"number"!==typeof t.distance||Number.isNaN(t.distance)?-1:e.distance-t.distance})),e.abrupt("return",i);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(e){var t=i.a.useState(),n=Object(f.a)(t,2),r=n[0],a=n[1],s=i.a.useState(e.data),o=Object(f.a)(s,2),c=o[0],l=o[1];i.a.useEffect((function(){var t=!0;return R(e.data).then((function(e){t&&l(e)})),function(){t=!1}}),[e.data]);var u=function(e){e&&a(e)};return Object(v.jsxs)("div",{className:"shop-list",children:[c.map((function(e){return Object(v.jsx)("div",{className:"shop",children:Object(v.jsx)(P,{data:e,popupHandler:u})},e.index)})),r?Object(v.jsx)(y,{shop:r,close:function(){a(void 0)}}):Object(v.jsx)(v.Fragment,{})]})},A=n(62),W=(n(88),function(e){var t=i.a.useState(""),n=Object(f.a)(t,2),r=n[0],a=n[1];return i.a.useEffect((function(){e.data&&fetch(e.data).then((function(e){return e.ok?e.text():Promise.reject(e.status)})).then((function(e){a(e)}))}),[e.data]),Object(v.jsx)("div",{className:"about-us",children:Object(v.jsx)("div",{className:"container",children:Object(v.jsx)(A.a,{children:r})})})}),M=(n(89),function(){return Object(v.jsx)("div",{className:"tabbar",children:Object(v.jsx)("ul",{children:C.menus.map((function(e,t){return Object(v.jsx)("li",{children:Object(v.jsxs)("a",{href:"".concat("/iss-map-for-kids","/#").concat(e.url),children:[Object(v.jsx)("div",{className:"icon",children:Object(v.jsx)("i",{className:e.icon})}),Object(v.jsx)("div",{className:"text",children:e.title})]})},t)}))})})}),$=n(63),B=n.n($),q=function(){var e=i.a.useState([]),t=Object(f.a)(e,2),n=t[0],r=t[1];i.a.useEffect((function(){var e="".concat(window.location.origin).concat(window.location.pathname,"/data.csv");fetch(e).then((function(e){return e.ok?e.text():Promise.reject(e.status)})).then((function(e){B()(e,function(){var e=Object(d.a)(c.a.mark((function e(t,n){var i,a,s,o,d,f,j,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return console.log(t),r([]),e.abrupt("return");case 4:i=Object(u.a)(n),a=i[0],s=i.slice(1),o=s.map((function(e){return a.reduce((function(t,n){var r=e[a.indexOf(n)];return t[n]=r.replace(/[\uff01-\uff5e]/g,(function(e){return String.fromCharCode(e.charCodeAt(0)-65248)})).replace(/\u3000/g," "),t}),{})})),d=[],f=0;case 8:if(!(f<o.length)){e.next=21;break}if((j=o[f]).lat&&j.lng){e.next=12;break}return e.abrupt("continue",18);case 12:if(j.lat.match(/^[0-9]+(\.[0-9]+)?$/)){e.next=14;break}return e.abrupt("continue",18);case 14:if(j.lng.match(/^[0-9]+(\.[0-9]+)?$/)){e.next=16;break}return e.abrupt("continue",18);case 16:p=Object(l.a)({index:f},j),d.push(p);case 18:f++,e.next=8;break;case 21:r(d);case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}))}),[]);var a=C.menus.map((function(e,t){if("/"!==e.url&&"/list"!==e.url)return Object(v.jsx)(j.a,{exact:!0,path:"".concat(e.url),children:Object(v.jsx)(W,{data:e.content})},t)}));return Object(v.jsxs)("div",{className:"app",children:[Object(v.jsx)("div",{className:"app-body",children:Object(v.jsxs)(p.a,{children:[Object(v.jsx)(j.a,{exact:!0,path:"/",children:Object(v.jsx)(L,{data:n})}),Object(v.jsx)(j.a,{exact:!0,path:"/list",children:Object(v.jsx)(T,{data:n})}),a]})}),Object(v.jsx)("div",{className:"app-footer",children:Object(v.jsx)(M,{})})]})},H=(n(128),n(67)),J=n.n(H),U=n(138),G=n(140),I=n(142),Z=n(139),D=n(141),K=n(143),Q=(n(134),function(){var e=window.location.href.replace(/\?.+$/,"").replace(/#.+$/,"");return Object(v.jsx)("div",{className:"share",children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:Object(v.jsx)("a",{href:"/",children:Object(v.jsx)(U.a,{url:e,hashtags:["issmap"],title:"".concat(C.title),children:Object(v.jsx)(Z.a,{size:32,round:!0})})})}),Object(v.jsx)("li",{children:Object(v.jsx)("a",{href:"/",children:Object(v.jsx)(G.a,{url:e,hashtag:"#issmap",children:Object(v.jsx)(D.a,{size:32,round:!0})})})}),Object(v.jsx)("li",{children:Object(v.jsx)("a",{href:"/",children:Object(v.jsx)(I.a,{url:e,title:"".concat(C.title),children:Object(v.jsx)(K.a,{size:32,round:!0})})})})]})})}),V=function(){var e=window.location.href.replace(/\?.+$/,"").replace(/#.+$/,"");return Object(v.jsxs)("div",{className:"about",children:[Object(v.jsxs)("div",{className:"branding",children:[Object(v.jsx)("div",{className:"image",children:Object(v.jsx)("img",{src:C.logo_image,alt:""})}),Object(v.jsx)("h1",{className:"logo",children:C.title})]}),Object(v.jsx)("h2",{className:"description",children:C.description}),Object(v.jsx)("div",{className:"qrcode",children:Object(v.jsx)(J.a,{value:e,bgColor:"transparent",fgColor:"#FFFFFF"})}),Object(v.jsx)(Q,{})]})};n(135);var X=function(){return Object(v.jsx)("div",{className:"outer-container",children:Object(v.jsxs)("div",{className:"inner-container",children:[Object(v.jsx)(V,{}),Object(v.jsx)(q,{})]})})},Y=(n(136),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function ee(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)(X,{})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/iss-map-for-kids",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/iss-map-for-kids","/service-worker.js");Y?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ee(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):ee(t,e)}))}}()},6:function(e){e.exports=JSON.parse('{"title":"\u30ed\u30b1\u30c3\u30c8\u89b3\u5149\u30de\u30c3\u30d7","description":"ISS\u306e\u73fe\u5728\u306e\u5834\u6240\u3068\u5404\u56fd\u306e\u30ed\u30b1\u30c3\u30c8\u6253\u3061\u4e0a\u3052\u5834\u306e\u60c5\u5831\u304c\u8f09\u3063\u3066\u3044\u308b\u5730\u56f3\u3067\u3059\u3002\u30ed\u30b1\u30c3\u30c8\u89b3\u5149\u3084\u5b87\u5b99\u6559\u80b2\u306b\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002","background_image":"https://kentarokiyono.github.io/iss-map-for-kids/background.jpg","logo_image":"https://kentarokiyono.github.io/iss-map-for-kids/iss.png","menus":[{"menu":null,"title":"\u30db\u30fc\u30e0","url":"/","icon":"fas fa-home"},{"menu":null,"title":"\u767a\u5c04\u5834\u4e00\u89a7","url":"/list","icon":"fas fa-list"}],"markers":{"clusterColor":"#4766F2"}}')},76:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){},88:function(e,t,n){},89:function(e,t,n){}},[[137,1,2]]]);
//# sourceMappingURL=main.dce57a50.chunk.js.map